bot NotionArchitect
  description "A smart bot that creates Notion pages and remembers your workspace structure."
  
  memory session
    var parentPageId string
  end

  # --- Setting the Parent ID ---
  on input when input contains "Page ID:"
    # This block captures the ID if you paste it
    # Usage: "Page ID: 12345abcde..."
    call ai.generate with prompt: f"Extract only the long alphanumeric ID from this text: {input}", format: "text" as id
    set $parentPageId = id
    say f"ğŸ”’ Root Page ID locked: {$parentPageId}"
    say "I will now create all new pages under this ID."
  end

  # --- Creating a Page ---
  on input when input contains "create page" or input contains "new page"
    say "ğŸ“ Crafting your new Notion page..."
    
    # We use our memory variable $parentPageId
    # If it's empty, the tool will try to auto-discover a page for you!
    call integrations.createNotionPage with {
      title: input.title ?? "New Notion Page",
      content: input.content ?? "This page was generated by your AI Assistant.",
      parent_page_id: $parentPageId
    } as res
    
    if res.success
      say f"âœ… Successfully created! View it here: {res.url}"
    else
      say "âš ï¸ I couldn't create the page automatically."
      say f"Reason: {res.output}"
      say "Tip: Paste your Notion Page ID like this: 'Page ID: XXXXXXX' so I know exactly where to put it!"
    end
  end

  # --- Default Response ---
  on input
    call general.respond with { prompt: input } as response
    say response.output
  end
end
